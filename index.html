<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistem Invoice & Surat Jalan - RAPA CEMENT & GRC</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.4.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ“„ RAPA CEMENT & GRC</h1>
        <p>Sistem Invoice & Surat Jalan Otomatis</p>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="switchTab('input')">
          Buat Transaksi
        </button>
        <button class="tab" onclick="switchTab('history')">Riwayat</button>
        <button class="tab" onclick="switchTab('settings')">Pengaturan</button>
      </div>

      <div class="content">
        <!-- TAB INPUT -->
        <div id="input-tab" class="tab-content active">
          <form id="transactionForm">
            <div class="section-title">ğŸ“‹ Data Transaksi</div>
            <div class="form-row-3">
              <div class="form-group">
                <label>Tanggal</label>
                <input type="date" id="date" required />
              </div>
              <div class="form-group">
                <label>No. Surat Jalan (Auto)</label>
                <input
                  type="text"
                  id="sjNumber"
                  readonly
                  style="background: #e9ecef"
                />
              </div>
              <div class="form-group">
                <label>No. PO (Auto)</label>
                <input
                  type="text"
                  id="poNumber"
                  readonly
                  style="background: #e9ecef"
                />
              </div>
            </div>

            <div class="section-title">ğŸ‘¤ Data Customer</div>
            <div class="form-group">
              <label>Nama Customer (Kepada Yth)</label>
              <input
                type="text"
                id="customerName"
                placeholder="Nama customer"
                required
              />
            </div>
            <div class="form-group">
              <label>Alamat Customer (di)</label>
              <textarea
                id="customerAddress"
                rows="3"
                placeholder="Alamat lengkap customer"
                required
              ></textarea>
            </div>

            <div class="section-title">ğŸ›’ Item Produk</div>
            <table class="items-table" id="itemsTable">
              <thead>
                <tr>
                  <th style="width: 5%">No</th>
                  <th style="width: 12%">Kode</th>
                  <th style="width: 35%">Nama Barang</th>
                  <th style="width: 10%">PCs</th>
                  <th style="width: 10%">MÂ²</th>
                  <th style="width: 15%">Harga</th>
                  <th style="width: 8%">Aksi</th>
                </tr>
              </thead>
              <tbody id="itemsBody">
                <tr>
                  <td class="item-no">1</td>
                  <td>
                    <input type="text" class="item-code" placeholder="Kode" />
                  </td>
                  <td>
                    <input
                      type="text"
                      class="item-name"
                      placeholder="Nama barang"
                      required
                    />
                  </td>
                  <td>
                    <input
                      type="number"
                      class="item-pcs"
                      value="0"
                      min="0"
                      step="1"
                    />
                  </td>
                  <td>
                    <input
                      type="number"
                      class="item-m2"
                      value="0"
                      min="0"
                      step="0.01"
                    />
                  </td>
                  <td>
                    <input
                      type="number"
                      class="item-price"
                      placeholder="0"
                      min="0"
                      required
                    />
                  </td>
                  <td>
                    <button
                      type="button"
                      class="btn btn-danger btn-small"
                      onclick="removeItem(this)"
                    >
                      Hapus
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            <button type="button" class="btn btn-secondary" onclick="addItem()">
              + Tambah Item
            </button>

            <div class="section-title">ğŸ’° Ringkasan Pembayaran</div>
            <div class="summary">
              <div class="summary-row">
                <span>Jumlah:</span>
                <span id="subtotalDisplay">Rp 0</span>
              </div>
              <div class="summary-row">
                <span>DP:</span>
                <span>
                  <input
                    type="number"
                    id="dp"
                    value="0"
                    min="0"
                    style="
                      width: 200px;
                      text-align: right;
                      padding: 8px;
                      border: 1px solid #ddd;
                      border-radius: 4px;
                    "
                  />
                </span>
              </div>
              <div class="summary-row">
                <span>Ongkir:</span>
                <span>
                  <input
                    type="number"
                    id="ongkir"
                    value="0"
                    min="0"
                    style="
                      width: 200px;
                      text-align: right;
                      padding: 8px;
                      border: 1px solid #ddd;
                      border-radius: 4px;
                    "
                  />
                </span>
              </div>
              <div class="summary-row total">
                <span>Kekurangan:</span>
                <span id="kekuranganDisplay">Rp 0</span>
              </div>
            </div>

            <div class="form-group">
              <label>Keterangan (Opsional)</label>
              <textarea
                id="keterangan"
                rows="2"
                placeholder="Keterangan tambahan untuk item tertentu"
              ></textarea>
            </div>

            <div class="actions">
              <button
                type="button"
                class="btn btn-secondary"
                onclick="resetForm()"
              >
                Reset Form
              </button>
              <button type="submit" class="btn btn-primary">
                ğŸš€ Generate Surat Jalan & Nota (PDF)
              </button>
              <button
                type="button"
                id="btnExcel"
                class="btn btn-success"
                onclick="generateTemplatesExcel()"
                style="display: none"
              >
                ğŸ“Š Download Excel (Beta)
              </button>
            </div>
          </form>
        </div>

        <!-- TAB HISTORY -->
        <div id="history-tab" class="tab-content">
          <div class="section-title">ğŸ“Š Riwayat Transaksi</div>
          <div id="historyContent">
            <div class="empty-state">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                />
              </svg>
              <h3>Belum Ada Transaksi</h3>
              <p>Buat transaksi pertama Anda di tab "Buat Transaksi"</p>
            </div>
          </div>
        </div>

        <!-- TAB SETTINGS -->
        <div id="settings-tab" class="tab-content">
          <div class="section-title">âš™ï¸ Pengaturan Perusahaan</div>

          <div class="form-group">
            <label>Logo Perusahaan (Klik untuk upload)</label>
            <div
              class="logo-upload"
              onclick="document.getElementById('logoInput').click()"
            >
              <input
                type="file"
                id="logoInput"
                accept="image/*"
                style="display: none"
                onchange="handleLogoUpload(event)"
              />
              <div id="logoPreviewContainer">
                <p>ğŸ“ Klik untuk upload logo (PNG, JPG)</p>
                <p style="font-size: 12px; color: #6c757d">
                  Rekomendasi: 200x80 pixels
                </p>
              </div>
            </div>
          </div>

          <div class="settings-grid">
            <div>
              <div class="form-group">
                <label>Nama Perusahaan</label>
                <input
                  type="text"
                  id="companyName"
                  placeholder="RAPA CEMENT & GRC"
                />
              </div>
              <div class="form-group">
                <label>Alamat Perusahaan</label>
                <textarea
                  id="companyAddress"
                  rows="3"
                  placeholder="Jl. Ngadiretno no. 33, Tamanagung, Muntilan, Magelang 56413"
                ></textarea>
              </div>
              <div class="form-group">
                <label>No. Telepon (pisahkan dengan /)</label>
                <input
                  type="text"
                  id="companyPhone"
                  placeholder="08112959125 / 082134567874"
                />
              </div>
              <div class="form-group">
                <label>Email</label>
                <input
                  type="email"
                  id="companyEmail"
                  placeholder="rapastone33@gmail.com"
                />
              </div>
            </div>
            <div>
              <div class="form-group">
                <label>Format Nomor Surat Jalan</label>
                <input
                  type="text"
                  id="sjFormat"
                  value="XXX"
                  placeholder="XXX"
                />
                <small style="color: #6c757d">XXX = Nomor urut</small>
              </div>
              <div class="form-group">
                <label>Format Nomor PO</label>
                <input
                  type="text"
                  id="poFormat"
                  value="PO-YYYY-MM-XXX"
                  placeholder="PO-YYYY-MM-XXX"
                />
                <small style="color: #6c757d"
                  >YYYY=Tahun, MM=Bulan, XXX=Nomor urut</small
                >
              </div>
              <div class="form-group">
                <label>Rekening Bank</label>
                <input
                  type="text"
                  id="bankAccount"
                  placeholder="BCA A.N NURJAMAL a c :1040257477"
                />
              </div>
              <button
                class="btn btn-success"
                onclick="saveSettings()"
                style="width: 100%; margin-top: 20px"
              >
                ğŸ’¾ Simpan Pengaturan
              </button>
            </div>
          </div>

          <div class="section-title" style="margin-top: 40px">
            ğŸ“ Catatan Default
          </div>
          <div class="form-group">
            <label>Catatan Surat Jalan</label>
            <textarea
              id="defaultNoteSJ"
              rows="3"
              placeholder="Catatan default untuk surat jalan"
            ></textarea>
          </div>
          <div class="form-group">
            <label>Catatan Nota Penjualan</label>
            <textarea
              id="defaultNoteNota"
              rows="2"
              placeholder="Catatan default untuk nota penjualan"
            ></textarea>
          </div>
          <button class="btn btn-success" onclick="saveSettings()">
            ğŸ’¾ Simpan Catatan
          </button>

          <div class="section-title" style="margin-top: 40px">
            ğŸ“Š Template Excel (Optional)
          </div>
          <div class="alert alert-info">
            <strong>Petunjuk:</strong> Upload file Excel (.xlsx) yang sudah
            diberi tag seperti <code>{{CUSTOMER_NAME}}</code>. File akan
            disimpan secara aman di browser Anda.
          </div>
          <div class="settings-grid">
            <div>
              <div class="form-group">
                <label>Template Surat Jalan (.xlsx)</label>
                <input
                  type="file"
                  id="excelTemplateSJ"
                  accept=".xlsx"
                  onchange="handleExcelUpload(event, 'sj')"
                />
                <div
                  id="statusSJ"
                  style="margin-top: 5px; font-size: 13px"
                ></div>
              </div>
            </div>
            <div>
              <div class="form-group">
                <label>Template Nota Penjualan (.xlsx)</label>
                <input
                  type="file"
                  id="excelTemplateNota"
                  accept=".xlsx"
                  onchange="handleExcelUpload(event, 'nota')"
                />
                <div
                  id="statusNota"
                  style="margin-top: 5px; font-size: 13px"
                ></div>
              </div>
            </div>
          </div>

          <div class="section-title" style="margin-top: 40px">
            ğŸ—‘ï¸ Data Management
          </div>
          <div class="alert alert-info">
            <strong>Info:</strong> Semua data disimpan di browser Anda
            (localStorage). Data tidak akan hilang kecuali Anda menghapus cache
            browser.
          </div>
          <button class="btn btn-danger" onclick="clearAllData()">
            âš ï¸ Hapus Semua Data
          </button>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
